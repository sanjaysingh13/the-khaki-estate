{% extends "base.html" %} {% load static %} {% block title %}Booking Calendar - Housing Complex Management{% endblock %} {% block content %}
<div class="container-fluid">
    <!-- Page Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="h3 mb-0">
                        <i class="fas fa-calendar-alt text-primary me-2"></i> Booking Calendar
                    </h1>
                    <p class="text-muted mb-0">View facility availability and existing bookings</p>
                </div>
                <div>
                    <a href="{% url 'backend:booking_create' %}" class="btn btn-primary me-2">
                        <i class="fas fa-plus me-2"></i>New Booking
                    </a>
                    <a href="{% url 'backend:booking_list' %}" class="btn btn-outline-primary">
                        <i class="fas fa-list me-2"></i>List View
                    </a>
                </div>
            </div>
        </div>
    </div>
    <!-- Calendar Navigation -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h5 class="mb-0">{{ current_month }}</h5>
                        </div>
                        <div class="btn-group" role="group">
                            <button type="button" class="btn btn-outline-primary" id="prev-month">
                  <i class="fas fa-chevron-left"></i>
                </button>
                            <button type="button" class="btn btn-outline-primary" id="current-month">
                  <i class="fas fa-calendar-day"></i> Today
                </button>
                            <button type="button" class="btn btn-outline-primary" id="next-month">
                  <i class="fas fa-chevron-right"></i>
                </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Facility Filter -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-4">
                            <label for="facility-filter" class="form-label">Filter by Facility</label>
                            <select class="form-select" id="facility-filter">
                  <option value="">All Facilities</option>
                  {% for area in common_areas %}<option value="{{ area.id }}">{{ area.name }}</option>{% endfor %}
                </select>
                        </div>
                        <div class="col-md-4">
                            <label for="status-filter" class="form-label">Filter by Status</label>
                            <select class="form-select" id="status-filter">
                  <option value="">All Status</option>
                  <option value="confirmed">Confirmed</option>
                  <option value="pending">Pending</option>
                  <option value="cancelled">Cancelled</option>
                </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">&nbsp;</label>
                            <div class="d-grid">
                                <button type="button" class="btn btn-outline-primary" id="apply-filters">
                    <i class="fas fa-filter me-2"></i>Apply Filters
                  </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Calendar View -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-calendar text-primary me-2"></i> Monthly Calendar View
                    </h5>
                </div>
                <div class="card-body">
                    <!-- Calendar Grid -->
                    <div class="calendar-container">
                        <div class="calendar-header">
                            <div class="calendar-day-header">Sun</div>
                            <div class="calendar-day-header">Mon</div>
                            <div class="calendar-day-header">Tue</div>
                            <div class="calendar-day-header">Wed</div>
                            <div class="calendar-day-header">Thu</div>
                            <div class="calendar-day-header">Fri</div>
                            <div class="calendar-day-header">Sat</div>
                        </div>
                        <div class="calendar-grid" id="calendar-grid">
                            <!-- Calendar days will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Legend -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <h6 class="card-title">
                        <i class="fas fa-info-circle me-2"></i>Legend & Usage Tips
                    </h6>
                    <div class="row">
                        <div class="col-lg-6">
                            <h6 class="text-muted">Booking Status Colors</h6>
                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="d-flex align-items-center mb-2">
                                        <div class="booking-status confirmed me-2"></div>
                                        <small>Confirmed/Approved</small>
                                    </div>
                                    <div class="d-flex align-items-center mb-2">
                                        <div class="booking-status pending me-2"></div>
                                        <small>Pending Approval</small>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="d-flex align-items-center mb-2">
                                        <div class="booking-status" style="background-color: #17a2b8;"></div>
                                        <small class="ms-2">Completed</small>
                                    </div>
                                    <div class="d-flex align-items-center mb-2">
                                        <div class="booking-status cancelled me-2"></div>
                                        <small>Cancelled/Rejected</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <h6 class="text-muted">How to Use</h6>
                            <ul class="list-unstyled small">
                                <li><i class="fas fa-calendar-day text-primary me-1"></i> Click on any date to create a new booking</li>
                                <li><i class="fas fa-eye text-info me-1"></i> Click on bookings to view details</li>
                                <li><i class="fas fa-filter text-success me-1"></i> Use filters to view specific facilities</li>
                                <li><i class="fas fa-lightbulb text-warning me-1"></i> Check availability before booking</li>
                            </ul>
                        </div>
                    </div>
                    {% if not is_committee %}
                    <div class="alert alert-info mt-3 mb-0">
                        <i class="fas fa-shield-alt me-2"></i>
                        <strong>Privacy Notice:</strong> You can see all bookings for planning purposes, but personal details are only shown for your own bookings.
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Booking Details Modal -->
<div class="modal fade" id="bookingModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Booking Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="booking-modal-body">
                <!-- Booking details will be populated by JavaScript -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="view-booking-details">
            <i class="fas fa-external-link-alt me-2"></i>View Full Details
          </button>
            </div>
        </div>
    </div>
</div>
<!-- CSS for Calendar -->
<style>
    .calendar-container {
        border: 1px solid #dee2e6;
        border-radius: 8px;
        overflow: hidden;
    }
    
    .calendar-header {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        background-color: #f8f9fa;
        border-bottom: 1px solid #dee2e6;
    }
    
    .calendar-day-header {
        padding: 12px;
        text-align: center;
        font-weight: 600;
        color: #6c757d;
        border-right: 1px solid #dee2e6;
    }
    
    .calendar-day-header:last-child {
        border-right: none;
    }
    
    .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        grid-template-rows: repeat(6, 1fr);
        min-height: 400px;
    }
    
    .calendar-day {
        border-right: 1px solid #dee2e6;
        border-bottom: 1px solid #dee2e6;
        padding: 8px;
        min-height: 60px;
        position: relative;
        cursor: pointer;
        transition: background-color 0.2s;
    }
    
    .calendar-day:last-child {
        border-right: none;
    }
    
    .calendar-day:hover {
        background-color: #f8f9fa;
    }
    
    .calendar-day.other-month {
        background-color: #f8f9fa;
        color: #6c757d;
    }
    
    .calendar-day.today {
        background-color: #e3f2fd;
        font-weight: 600;
    }
    
    .calendar-day-number {
        font-size: 14px;
        font-weight: 500;
        margin-bottom: 4px;
    }
    
    .booking-item {
        font-size: 10px;
        padding: 2px 4px;
        margin: 1px 0;
        border-radius: 3px;
        cursor: pointer;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    .booking-status {
        width: 16px;
        height: 16px;
        border-radius: 3px;
        display: inline-block;
    }
    
    .booking-status.confirmed {
        background-color: #28a745;
    }
    
    .booking-status.pending {
        background-color: #ffc107;
    }
    
    .booking-status.cancelled {
        background-color: #dc3545;
    }
    
    .booking-status.available {
        background-color: #6c757d;
    }
    
    .booking-item.confirmed {
        background-color: #d4edda;
        color: #155724;
        border-left: 3px solid #28a745;
    }
    
    .booking-item.pending {
        background-color: #fff3cd;
        color: #856404;
        border-left: 3px solid #ffc107;
    }
    
    .booking-item.cancelled {
        background-color: #f8d7da;
        color: #721c24;
        border-left: 3px solid #dc3545;
    }
    
    .more-bookings {
        font-size: 10px;
        color: #6c757d;
        font-style: italic;
        margin-top: 2px;
        cursor: pointer;
        text-decoration: underline;
    }
    
    .more-bookings:hover {
        color: #495057;
    }
    /* Enhanced mobile responsiveness */
    
    @media (max-width: 768px) {
        .calendar-container {
            font-size: 12px;
        }
        .calendar-day {
            min-height: 80px;
            padding: 4px;
        }
        .calendar-day-number {
            font-size: 12px;
        }
        .booking-item {
            font-size: 9px;
            padding: 1px 3px;
            margin: 1px 0;
        }
        .calendar-day-header {
            padding: 8px;
            font-size: 12px;
        }
    }
    
    @media (max-width: 576px) {
        .calendar-grid {
            min-height: 300px;
        }
        .calendar-day {
            min-height: 60px;
            padding: 2px;
        }
        .booking-item {
            font-size: 8px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        }
    }
    /* Enhanced booking status colors */
    
    .booking-item.approved {
        background-color: #d4edda;
        color: #155724;
        border-left: 3px solid #28a745;
    }
    
    .booking-item.completed {
        background-color: #d1ecf1;
        color: #0c5460;
        border-left: 3px solid #17a2b8;
    }
    
    .booking-item.rejected {
        background-color: #f8d7da;
        color: #721c24;
        border-left: 3px solid #dc3545;
        text-decoration: line-through;
        opacity: 0.7;
    }
    /* Calendar day hover effects */
    
    .calendar-day:hover {
        background-color: #f8f9fa;
        border: 2px solid #007bff;
    }
    
    .calendar-day.today {
        background-color: #e3f2fd;
        border: 2px solid #2196f3;
        font-weight: 600;
    }
    /* Loading indicator */
    
    .calendar-loading {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 400px;
        font-size: 18px;
        color: #6c757d;
    }
    
    .calendar-loading .spinner-border {
        width: 3rem;
        height: 3rem;
        margin-right: 1rem;
    }
</style>
  <!-- JavaScript for Calendar Functionality -->
  <script>
    /* eslint-disable */
    /* prettier-ignore */
    document.addEventListener('DOMContentLoaded', function() {
                // Initialize calendar with current month/year from server
      let currentDate = new Date({{ current_year }}, {{ current_month_number }} - 1, 1);
      let bookingsData = {{ bookings_by_area|safe }};
      let todayDate = new Date('{{ today }}');

                // Initialize calendar
                renderCalendar();

                // Calendar navigation with AJAX loading
                document.getElementById('prev-month').addEventListener('click', function() {
                    currentDate.setMonth(currentDate.getMonth() - 1);
                    loadCalendarData();
                });

                document.getElementById('next-month').addEventListener('click', function() {
                    currentDate.setMonth(currentDate.getMonth() + 1);
                    loadCalendarData();
                });

                document.getElementById('current-month').addEventListener('click', function() {
                    currentDate = new Date();
                    loadCalendarData();
                });

                // Filter functionality with AJAX loading
                document.getElementById('apply-filters').addEventListener('click', function() {
                    loadCalendarData();
                });

                // Function to load calendar data via AJAX
                function loadCalendarData() {
                    const facilityFilter = document.getElementById('facility-filter').value;
                    const month = currentDate.getMonth() + 1;
                    const year = currentDate.getFullYear();

                    // Show loading indicator
                    const calendarGrid = document.getElementById('calendar-grid');
                    calendarGrid.innerHTML = '<div class="text-center p-4"><i class="fas fa-spinner fa-spin"></i> Loading...</div>';

                    // Build URL with parameters
                    const apiUrl = new URL('{% url "backend:booking_calendar_api" %}', window.location.origin);
                    apiUrl.searchParams.append('month', month);
                    apiUrl.searchParams.append('year', year);
                    if (facilityFilter) {
                        apiUrl.searchParams.append('area', facilityFilter);
                    }

                    fetch(apiUrl)
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                // Update bookings data
                                if (facilityFilter) {
                                    // If filtering by facility, create filtered data structure
                                    bookingsData = {};
                                    bookingsData[facilityFilter] = data.bookings.filter(b => b.common_area_id == facilityFilter);
                                } else {
                                    // Group bookings by area
                                    bookingsData = {};
                                    data.bookings.forEach(booking => {
                                        const areaId = booking.common_area_id.toString();
                                        if (!bookingsData[areaId]) {
                                            bookingsData[areaId] = [];
                                        }
                                        bookingsData[areaId].push(booking);
                                    });
                                }

                                // Update month display
                                document.querySelector('.card-body h5').textContent = data.month_name;

                                // Re-render calendar
                                renderCalendar();
                            } else {
                                console.error('Failed to load calendar data:', data.error);
                                calendarGrid.innerHTML = '<div class="text-center p-4 text-danger"><i class="fas fa-exclamation-triangle"></i> Failed to load calendar data</div>';
                            }
                        })
                        .catch(error => {
                            console.error('Error loading calendar data:', error);
                            calendarGrid.innerHTML = '<div class="text-center p-4 text-danger"><i class="fas fa-exclamation-triangle"></i> Failed to load calendar data</div>';
                        });
                }

                function renderCalendar() {
                    const year = currentDate.getFullYear();
                    const month = currentDate.getMonth();

                    // Update month display
                    const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                        'July', 'August', 'September', 'October', 'November', 'December'
                    ];
                    document.querySelector('.card-body h5').textContent = `${monthNames[month]} ${year}`;

                    // Get first day of month and number of days
                    const firstDay = new Date(year, month, 1);
                    const lastDay = new Date(year, month + 1, 0);
                    const daysInMonth = lastDay.getDate();
                    const startingDayOfWeek = firstDay.getDay();

                    // Clear calendar grid
                    const calendarGrid = document.getElementById('calendar-grid');
                    calendarGrid.innerHTML = '';

                    // Add empty cells for days before the first day of the month
                    for (let i = 0; i < startingDayOfWeek; i++) {
                        const dayElement = createDayElement(0, true);
                        calendarGrid.appendChild(dayElement);
                    }

                    // Add days of the month
                    for (let day = 1; day <= daysInMonth; day++) {
                        const dayElement = createDayElement(day, false);
                        calendarGrid.appendChild(dayElement);
                    }

                    // Fill remaining cells to complete the grid
                    const totalCells = calendarGrid.children.length;
                    const remainingCells = 42 - totalCells; // 6 rows * 7 days
                    for (let i = 0; i < remainingCells; i++) {
                        const dayElement = createDayElement(0, true);
                        calendarGrid.appendChild(dayElement);
                    }
                }

                function createDayElement(day, isOtherMonth) {
                    const dayElement = document.createElement('div');
                    dayElement.className = 'calendar-day';

                    if (isOtherMonth) {
                        dayElement.classList.add('other-month');
                    } else {
                        dayElement.classList.add('calendar-day');

                        // Check if it's today using the server-provided today date
                        if (day === todayDate.getDate() &&
                            currentDate.getMonth() === todayDate.getMonth() &&
                            currentDate.getFullYear() === todayDate.getFullYear()) {
                            dayElement.classList.add('today');
                        }

                        // Add day number
                        const dayNumber = document.createElement('div');
                        dayNumber.className = 'calendar-day-number';
                        dayNumber.textContent = day;
                        dayElement.appendChild(dayNumber);

                        // Add click handler for day selection (for future quick booking feature)
                        dayElement.addEventListener('click', function(e) {
                            // Don't trigger if clicking on a booking item
                            if (!e.target.classList.contains('booking-item')) {
                                handleDayClick(day);
                            }
                        });

                        // Add bookings for this day
                        addBookingsToDay(dayElement, day);
                    }

                    return dayElement;
                }

                // Function to handle day clicks (for future quick booking feature)
                function handleDayClick(day) {
                    const selectedDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), day);
                    const today = new Date();

                    // Only allow booking for future dates
                    if (selectedDate >= today.setHours(0, 0, 0, 0)) {
                        // Fix timezone issue: Use local date formatting instead of ISO
                        // This ensures the date is formatted in the user's local timezone
                        const year = selectedDate.getFullYear();
                        const month = String(selectedDate.getMonth() + 1).padStart(2, '0');
                        const dayStr = String(selectedDate.getDate()).padStart(2, '0');
                        const dateString = `${year}-${month}-${dayStr}`;
                        
                        window.location.href = `{% url 'backend:booking_create' %}?date=${dateString}`;
                    }
                }

                function addBookingsToDay(dayElement, day) {
                    const facilityFilter = document.getElementById('facility-filter').value;
                    const statusFilter = document.getElementById('status-filter').value;

                    let dayBookings = [];

                    // Collect bookings for this day
                    Object.keys(bookingsData).forEach(facilityId => {
                        if (facilityFilter && facilityId !== facilityFilter) return;

                        const facilityBookings = bookingsData[facilityId];
                        facilityBookings.forEach(booking => {
                            const bookingDate = new Date(booking.booking_date);
                            if (bookingDate.getDate() === day &&
                                bookingDate.getMonth() === currentDate.getMonth() &&
                                bookingDate.getFullYear() === currentDate.getFullYear()) {

                                if (!statusFilter || booking.status === statusFilter) {
                                    dayBookings.push(booking);
                                }
                            }
                        });
                    });

                    // Sort bookings by start time
                    dayBookings.sort((a, b) => a.start_time.localeCompare(b.start_time));

                    // Display bookings (limit to 3 visible)
                    const maxVisible = 3;
                    dayBookings.slice(0, maxVisible).forEach(booking => {
                        const bookingElement = document.createElement('div');

                        // Enhanced status classes for better visibility
                        let statusClass = booking.status;
                        if (booking.status === 'approved') statusClass = 'confirmed'; // Treat approved as confirmed for display

                        bookingElement.className = `booking-item ${statusClass}`;

                        // Show different information based on user permissions
                        let displayText = '';
                        if (booking.is_own_booking) {
                            displayText = `${booking.start_time} - ${booking.common_area_name}`;
                        } else {
                            displayText = `${booking.start_time} - ${booking.common_area_name} (Booked)`;
                        }

                        bookingElement.textContent = displayText;
                        bookingElement.title = `${booking.purpose} (${booking.status})`;
                        bookingElement.onclick = () => showBookingDetails(booking);
                        dayElement.appendChild(bookingElement);
                    });

                    // Show "more" indicator if there are additional bookings
                    if (dayBookings.length > maxVisible) {
                        const moreElement = document.createElement('div');
                        moreElement.className = 'more-bookings';
                        moreElement.textContent = `+${dayBookings.length - maxVisible} more`;
                        moreElement.onclick = () => showDayBookings(day, dayBookings);
                        dayElement.appendChild(moreElement);
                    }
                }

                // Function to show all bookings for a specific day
                function showDayBookings(day, dayBookings) {
                    const modalBody = document.getElementById('booking-modal-body');
                    const selectedDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), day);
                    const dateString = selectedDate.toLocaleDateString('en-US', {
                        weekday: 'long',
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });
                    
                    // Create proper date string for booking URL (timezone-safe)
                    const year = selectedDate.getFullYear();
                    const month = String(selectedDate.getMonth() + 1).padStart(2, '0');
                    const dayStr = String(selectedDate.getDate()).padStart(2, '0');
                    const bookingDateString = `${year}-${month}-${dayStr}`;

                    let bookingsList = dayBookings.map(booking => {
                        const statusBadge = `<span class="badge bg-${booking.status === 'confirmed' || booking.status === 'approved' ? 'success' : booking.status === 'pending' ? 'warning' : 'danger'}">${booking.status}</span>`;
                        return `
            <div class="border-bottom pb-2 mb-2">
              <div class="d-flex justify-content-between align-items-start">
                <div>
                  <strong>${booking.common_area_name}</strong><br>
                  <small class="text-muted">${booking.start_time} - ${booking.end_time}</small><br>
                  <small>${booking.purpose}</small>
                </div>
                <div class="text-end">
                  ${statusBadge}
                  ${booking.is_own_booking ? '<br><small class="text-muted">Your booking</small>' : ''}
                </div>
              </div>
            </div>
          `;
                    }).join('');

                    modalBody.innerHTML = `
          <h6>${dateString} - All Bookings</h6>
          <div class="mt-3">
            ${bookingsList}
          </div>
          <div class="mt-3 text-center">
            <button class="btn btn-primary" onclick="window.location.href='{% url 'backend:booking_create' %}?date=${bookingDateString}'">
              <i class="fas fa-plus me-2"></i>New Booking for This Date
            </button>
          </div>
        `;

                    // Update view details button to be hidden for day view
                    const viewDetailsBtn = document.getElementById('view-booking-details');
                    viewDetailsBtn.style.display = 'none';

                    // Show modal
                    const modal = new bootstrap.Modal(document.getElementById('bookingModal'));
                    modal.show();
                }

                function showBookingDetails(booking) {
                    const modalBody = document.getElementById('booking-modal-body');

                    // Enhanced status badge with proper colors
                    let statusBadgeClass = 'secondary';
                    if (booking.status === 'confirmed' || booking.status === 'approved') statusBadgeClass = 'success';
                    else if (booking.status === 'pending') statusBadgeClass = 'warning';
                    else if (booking.status === 'cancelled' || booking.status === 'rejected') statusBadgeClass = 'danger';
                    else if (booking.status === 'completed') statusBadgeClass = 'info';

                    // Format date for better display
                    const bookingDate = new Date(booking.booking_date);
                    const formattedDate = bookingDate.toLocaleDateString('en-US', {
                        weekday: 'long',
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });

                    modalBody.innerHTML = `
            <div class="row">
                <div class="col-md-6">
                    <h6><i class="fas fa-info-circle text-primary me-2"></i>Booking Information</h6>
                    ${booking.booking_number ? `<p><strong>Booking Number:</strong> ${booking.booking_number}</p>` : ''}
                    <p><strong>Facility:</strong> ${booking.common_area_name}</p>
                    <p><strong>Date:</strong> ${formattedDate}</p>
                    <p><strong>Time:</strong> ${booking.start_time} - ${booking.end_time}</p>
                    <p><strong>Status:</strong> <span class="badge bg-${statusBadgeClass}">${booking.status.charAt(0).toUpperCase() + booking.status.slice(1)}</span></p>
                </div>
                <div class="col-md-6">
                    <h6><i class="fas fa-clipboard-list text-primary me-2"></i>Booking Details</h6>
                    <p><strong>Purpose:</strong> ${booking.purpose}</p>
                    ${booking.guests_count !== undefined ? `<p><strong>Guests:</strong> ${booking.guests_count}</p>` : ''}
                    ${booking.total_fee !== undefined ? `<p><strong>Fee:</strong> ₹${booking.total_fee}</p>` : ''}
                    ${booking.is_own_booking ? '<p class="text-success"><i class="fas fa-user-check me-1"></i><strong>Your Booking</strong></p>' : ''}
                </div>
            </div>
            ${booking.resident_name && booking.resident_flat ? `
            <div class="row mt-3">
                <div class="col-12">
                    <h6><i class="fas fa-user text-primary me-2"></i>Resident Information</h6>
                    <p><strong>Name:</strong> ${booking.resident_name}</p>
                    <p><strong>Flat:</strong> ${booking.resident_flat}</p>
                </div>
            </div>
            ` : ''}
            <div class="row mt-3">
                <div class="col-12">
                    <div class="alert alert-info">
                        <i class="fas fa-lightbulb me-2"></i>
                        <strong>Planning Tip:</strong> Use this calendar to see when facilities are available before making your booking request.
                    </div>
                </div>
            </div>
        `;

        // Update view details button - only show for own bookings or committee members
        const viewDetailsBtn = document.getElementById('view-booking-details');
        if (booking.is_own_booking || {{ is_committee|yesno:"true,false" }}) {
          viewDetailsBtn.style.display = 'inline-block';
          viewDetailsBtn.onclick = () => {
            window.location.href = `/backend/bookings/${booking.id}/`;
          };
        } else {
          viewDetailsBtn.style.display = 'none';
        }

        // Show modal
        const modal = new bootstrap.Modal(document.getElementById('bookingModal'));
        modal.show();
      }

      // Initialize calendar on page load
      renderCalendar();
    });
    /* eslint-enable */
  </script>
{% endblock %}